# K-Surveyflow

설문조사 데이터 자동 분석 및 HTML 보고서 생성 시스템

## 프로젝트 개요

K-Surveyflow는 CSV 형태의 설문조사 데이터를 입력받아 HTML 형태의 종합 분석 보고서를 자동 생성하는 Python 기반 도구입니다. 

## 주요 기능

### 📊 자동 문항 분석
- **8가지 문항 유형 지원**: 객관식, 주관식, 평가형, 콘텐츠형, 목록형, 카드형, 이분형, 순위형
- **자동 문항 분류**: 문항 코드에 따른 자동 문항 유형 판별 및 적절한 시각화 방식 적용
- **동적 컴포넌트 시스템**: 문항 타입별로 최적화된 컴포넌트 자동 적용

### 🔍 세그먼트별 교차분석
- **다양한 세그먼트**: 성별, 연령대, 계좌고객 여부, 가입경과일, VASP 연결, 상품 가입 여부 등
- **히트맵 생성**: 객관식/평가형 문항에 대한 세그먼트별 교차분석 히트맵
- **엣지케이스 탐지**: 세그먼트 간 차이가 큰 케이스를 자동 탐지하여 강조 표시

### 📝 주관식 분석
- **키워드 분석**: 주관식 문항의 자동 키워드 추출 및 감정 분류
- **5가지 감정 분류**: 긍정, 부정, 제안, 문의, 무응답
- **카테고리별 분석**: LLM 기반 카테고리 분류 및 빈도 분석

### 📧 이메일 호환성
- **Outlook 2019 최적화**: MS Outlook 2019 환경에서의 완벽한 렌더링 보장
- **반응형 레이아웃**: 테이블 기반 반응형 레이아웃으로 다양한 화면 크기 지원
- **자동 이메일 발송**: 생성된 보고서를 지정된 수신자에게 자동 발송

## 설치 및 실행

### 환경 요구사항
- Python 3.7 이상
- 필요한 라이브러리: csv, sys, os, re, math, collections, datetime, typing, itertools

### 실행 방법
```bash
# 1. 프로젝트 디렉토리로 이동
cd /path/to/K-Surveyflow

# 2. 특정 CSV 파일로 보고서 생성
python main.py --csv_file data/20250916_sample_data.csv

# 3. 생성된 보고서 확인
# reports/ 폴더에서 HTML 파일 확인
```

## 데이터 구조

### CSV 파일 구조
- **기본 파일**: `data/20250916_sample_data.csv`
- **데이터 디렉토리**: `data/` 폴더 내 위치
- **CLI 옵션**: `--csv` 옵션으로 다른 CSV 파일 지정 가능
- .gitignore에 등록되어 있음

### 주요 컬럼
- **`qsit_sqn`**: 문항 그룹핑 키 및 정렬 기준
- **`qsit_ttl`**: 문항 제목
- **`qsit_type_ds_cd`**: 문항 타입 코드 (10: 객관식, 20: 주관식, 30: 평가형 등)
- **`lkng_cntnt`**: 객관식 선택지 라벨
- **`answ_cntnt`**: 주관식 자유 응답 내용
- **`cust_id`**: 응답자 고유 식별자
- **`surv_date`**: 설문 수집 날짜

### 세그먼트 변수
- **`gndr_seg`**: 성별 세그먼트
- **`age_seg`**: 연령대 세그먼트
- **`account_seg`**: 계좌고객 여부
- **`rgst_gap`**: 가입경과일
- **`vasp`**: VASP 연결 여부
- **`dp_seg`**: 수신상품 가입 여부
- **`loan_seg`**: 대출상품 가입 여부
- **`card_seg`**: 카드상품 가입 여부
- **`suv_seg`**: 서비스 이용 여부

## 문항 유형별 처리

### 1. 객관식 (objective)
- **시각화**: 일반형 응답통계 + 일반형 히트맵+교차분석
- **특징**: 세그먼트별 응답 분포를 색상 강도로 표현

### 2. 평가형 (evaluation)
- **시각화**: 일반형 응답통계 + 평가형 히트맵+교차분석
- **특징**: 만족도 5단계 + 순만족도 + 평균점수 표시

### 3. 주관식 (subjective)
- **시각화**: 주관식 요약
- **특징**: 키워드 분석, 감정 분류, 카테고리별 빈도 분석

### 4. 순위형 (ranking)
- **시각화**: 순위형 응답통계 + 순위형 차트
- **특징**: 순위별 응답 분포를 시각화

## 색상 시스템

### 색상 팔레트
- **PRIMARY_PALETTE**: 메인 색상 (파랑 계열, 11단계)
- **CONTRAST_PALETTE**: 대비 색상 (그린 계열, 11단계)
- **GRAYSCALE_PALETTE**: 그레이스케일 (회색 계열, 11단계)

### 색상 구성
- **히트맵**: PRIMARY_PALETTE 기반 색상 적용
- **응답통계**: 문항 수에 따른 최적화된 색상 선택 (COLOR_CONFIG 기반)
- **주관식**: 긍정(파랑), 부정(그린), 중립(회색) 구분
- **그레이스케일**: 통계적 유의성 부족 시 자동 적용 (0.5% 미만)

## 고급 기능

### 교차분석 엣지케이스 탐지
- **2차원 교차분석**: 복잡한 세그먼트 조합 분석
- **차이 임계값**: 전체 대비 10% 이상 차이 시 강조 표시
- **평가형 차이 임계값**: 평균 점수 대비 5% 이상 차이 시 강조 표시
- **자동 탐지**: 특정 세그먼트 조합에서 예상과 다른 응답 패턴 발견

### 주관식 분석 개선
- **5가지 감정 분류**: 긍정, 부정, 제안, 문의, 무응답
- **응답 길이 필터링**: 5자 미만 응답 자동 제외
- **카테고리 정리**: "NN. " 접두사 자동 제거

### 히트맵 디자인 개선
- **스페이서 열 고정**: 20px 고정으로 일관된 레이아웃
- **대시라인 구분**: 세그먼트 간 명확한 시각적 구분
- **기타열 색상 고정**: #D1D5DB로 통일된 색상 표시

## 출력 파일

### 보고서 파일
- **위치**: `reports/` 폴더
- **형식**: HTML 파일
- **이름**: `survey_report_{N}of{M}_{YYYYMMDD}.html`
  - N: 현재 보고서 번호
  - M: 전체 보고서 수
  - YYYYMMDD: 생성 날짜
- **다중 보고서**: main_ttl별로 별도 보고서 생성
- .gitignore에 등록되어 있음


## 기술적 특징

### 이메일 호환성
- **테이블 기반 레이아웃**: 모든 레이아웃을 `<table>` 태그로 구성
- **인라인 CSS**: 모든 스타일을 인라인으로 적용
- **조건부 주석**: Outlook 전용 스타일 적용
- **폰트 스택**: 크로스 플랫폼 호환 폰트 설정

### 성능 최적화
- **메모리 최적화**: 효율적인 데이터 구조 사용
- **코드 최적화**: 불필요한 함수 제거 및 헬퍼 함수 활용
- **렌더링 최적화**: CSS 및 HTML 구조 최적화

## 문제 해결

### 자주 발생하는 오류
1. **파일 경로 오류**: 작업 디렉터리 확인
2. **CSV 인코딩 오류**: UTF-8 인코딩으로 저장
3. **CSV 파일 없음**: `--csv` 옵션으로 올바른 파일 경로 지정
4. **Outlook 렌더링 문제**: 테이블 기반 레이아웃 사용

### 성능 문제
- **메모리 부족**: 대용량 데이터 처리 시 서버 환경 사용 권장
- **처리 시간**: 데이터 분할 처리로 최적화
